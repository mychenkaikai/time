---
/**
 * é¦–é¡µ - æ–‡ç« åˆ—è¡¨
 * ä¸‰æ å¸ƒå±€ï¼šé¡¶éƒ¨å¯¼èˆª + å·¦ä¾§åˆ†ç±»å¯¼èˆª + å³ä¾§å†…å®¹åŒº
 */

import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import TopNav from '../components/TopNav.astro';
import SideNav from '../components/SideNav.astro';
import WindowFrame from '../components/WindowFrame.astro';

// è·å–æ‰€æœ‰æ–‡ç« ï¼Œè¿‡æ»¤è‰ç¨¿ï¼ŒæŒ‰æ—¥æœŸå€’åº
const allPosts = await getCollection('posts', ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort((a, b) => {
  return b.data.date.getTime() - a.data.date.getTime();
});

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  }).format(date);
};

const baseUrl = import.meta.env.BASE_URL;
---

<BaseLayout title="é¦–é¡µ" description="æ€€æ—§æ•°å­—åšç‰©é¦† - è®°å½•æ—§æ—¶å…‰çš„ç²¾ç¥è§’è½">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <TopNav currentPath="/" />

  <!-- ä¸»å†…å®¹åŒºï¼šå·¦ä¾§å¯¼èˆª + å³ä¾§å†…å®¹ -->
  <div class="main-layout">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <div class="sidebar">
      <SideNav />
    </div>

    <!-- å³ä¾§å†…å®¹åŒº -->
    <div class="content-area">
      <!-- ç½‘ç«™æ ‡é¢˜ -->
      <WindowFrame title="æ€€æ—§æ•°å­—åšç‰©é¦† v1.0">
        <div class="site-header">
          <h1>ğŸ–¥ï¸ æ¬¢è¿æ¥åˆ°æ€€æ—§æ•°å­—åšç‰©é¦†</h1>
          <p class="site-description">
            è¿™é‡Œæ˜¯ä¸ºé«˜æ•äººç¾¤ï¼ˆHSPï¼‰æ‰“é€ çš„ç²¾ç¥è§’è½ï¼Œ<br />
            å¤åˆ» 80/90 å¹´ä»£äº’è”ç½‘çš„ä»ªå¼æ„Ÿã€‚
          </p>
        </div>
      </WindowFrame>

      <!-- æœ€æ–°æ–‡ç«  -->
      <WindowFrame title="ğŸ“ æœ€æ–°æ–‡ç« ">
        {sortedPosts.length === 0 ? (
          <div class="empty-state">
            <p>è¿˜æ²¡æœ‰æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…...</p>
          </div>
        ) : (
          <div class="posts-list">
            {sortedPosts.slice(0, 10).map((post) => (
              <article class="post-item">
                <div class="post-item-header">
                  <h2 class="post-item-title">
                    <a href={`${baseUrl}posts/${post.slug}`}>{post.data.title}</a>
                  </h2>
                  <span class="post-item-date">{formatDate(post.data.date)}</span>
                </div>
                
                <div class="post-item-meta">
                  <span class="post-category">ğŸ“ {post.data.category}</span>
                  {post.data.subcategory && (
                    <span class="post-subcategory">/ {post.data.subcategory}</span>
                  )}
                </div>
                
                <p class="post-item-description">{post.data.description}</p>
                
                {post.data.tags.length > 0 && (
                  <div class="post-item-tags">
                    {post.data.tags.map((tag) => (
                      <span class="tag">{tag}</span>
                    ))}
                  </div>
                )}
                
                {post.data.mood && (
                  <div class="post-item-mood">
                    ğŸ’­ {post.data.mood}
                  </div>
                )}
              </article>
            ))}
          </div>
        )}
      </WindowFrame>

      <!-- é¡µè„šä¿¡æ¯ -->
      <WindowFrame title="â„¹ï¸ å…³äº">
        <div class="site-footer">
          <p>
            æœ¬ç«™ä½¿ç”¨ <strong>Astro</strong> æ„å»ºï¼Œé‡‡ç”¨ <strong>Windows 98</strong> å¤å¤é£æ ¼ã€‚<br />
            Â© 2024 æ€€æ—§æ•°å­—åšç‰©é¦† | ç”¨ â¤ï¸ æ‰“é€ 
          </p>
        </div>
      </WindowFrame>
    </div>
  </div>
</BaseLayout>

<style>
  /* ä¸»å¸ƒå±€ï¼šå·¦ä¾§å¯¼èˆª + å³ä¾§å†…å®¹ */
  .main-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: var(--spacing-md);
    align-items: start;
  }

  .sidebar {
    /* ä¾§è¾¹æ æ ·å¼åœ¨ SideNav ç»„ä»¶ä¸­ */
  }

  .content-area {
    min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
  }

  /* ç½‘ç«™å¤´éƒ¨ */
  .site-header {
    text-align: center;
    padding: var(--spacing-lg) 0;
    background: #ffffff;
  }

  .site-header h1 {
    font-size: var(--font-size-xl);
    margin-bottom: var(--spacing-md);
  }

  .site-description {
    color: var(--border-dark);
    line-height: 1.6;
  }

  /* æ–‡ç« åˆ—è¡¨ */
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .post-item {
    padding: var(--spacing-md);
    background: #ffffff;
    border: 1px solid var(--border-dark);
    transition: all 0.2s;
  }

  .post-item:hover {
    background: #ffffff;
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    transform: translateY(-1px);
  }

  .post-item-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
    flex-wrap: wrap;
  }

  .post-item-title {
    margin: 0;
    font-size: var(--font-size-lg);
    flex: 1;
  }

  .post-item-title a {
    text-decoration: none;
    color: var(--link-color);
  }

  .post-item-title a:hover {
    text-decoration: underline;
  }

  .post-item-date {
    font-size: var(--font-size-sm);
    color: var(--border-dark);
    white-space: nowrap;
  }

  .post-item-meta {
    font-size: var(--font-size-sm);
    color: var(--border-dark);
    margin-bottom: var(--spacing-sm);
  }

  .post-category {
    font-weight: bold;
  }

  .post-subcategory {
    margin-left: var(--spacing-xs);
  }

  .post-item-description {
    margin-bottom: var(--spacing-sm);
    line-height: 1.6;
  }

  .post-item-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-xs);
  }

  .tag {
    background: var(--button-bg);
    padding: 2px 8px;
    font-size: var(--font-size-sm);
    box-shadow: inset -1px -1px 0 var(--border-darkest),
                inset 1px 1px 0 var(--border-light);
  }

  .post-item-mood {
    font-size: var(--font-size-sm);
    color: var(--border-dark);
    font-style: italic;
  }

  .empty-state {
    text-align: center;
    padding: var(--spacing-xl);
    color: var(--border-dark);
  }

  /* é¡µè„š */
  .site-footer {
    text-align: center;
    font-size: var(--font-size-sm);
    color: var(--border-dark);
    background: #ffffff;
  }

  /* å“åº”å¼ */
  @media (max-width: 1024px) {
    .main-layout {
      grid-template-columns: 1fr;
    }

    .sidebar {
      order: 2;
    }

    .content-area {
      order: 1;
    }
  }

  @media (max-width: 768px) {
    .post-item-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .post-item-date {
      order: -1;
    }
  }
</style>

