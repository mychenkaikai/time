---
import Search from './Search.astro';
import WindowFrame from './WindowFrame.astro';
---

<div id="search-modal" class="search-modal" style="display: none;">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <WindowFrame title="ðŸ”Ž Find Relics">
      <div class="search-container">
        <Search />
        <div class="modal-actions">
          <button id="close-search-btn">Close</button>
        </div>
      </div>
    </WindowFrame>
  </div>
</div>

<script>
  const modal = document.getElementById('search-modal');
  const overlay = modal?.querySelector('.modal-overlay');
  const closeBtn = document.getElementById('close-search-btn');

  function closeSearch() {
    if (modal) modal.style.display = 'none';
  }

  function openSearch() {
    if (modal) modal.style.display = 'block';
    // Focus input if possible
    setTimeout(() => {
      const input = modal?.querySelector('input');
      if (input) input.focus();
    }, 100);
  }

  // Expose to window for other components to call
  (window as any).openSearchModal = openSearch;

  if (overlay) overlay.addEventListener('click', closeSearch);
  if (closeBtn) closeBtn.addEventListener('click', closeSearch);

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && modal.style.display === 'block') {
      closeSearch();
    }
  });
</script>

<style>
  .search-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 600px;
  }

  .search-container {
    padding: 10px;
  }

  .modal-actions {
    margin-top: 10px;
    text-align: right;
  }

  #close-search-btn {
    min-width: 80px;
  }
</style>
